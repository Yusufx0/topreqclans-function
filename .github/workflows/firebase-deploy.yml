name: Deploy Cloud Functions

on:
  push:
    branches:
      - main

jobs:
  deploy: # 'build' yerine 'deploy' olarak değiştirildi
    runs-on: ubuntu-latest
    
    steps:
      # 1. Repo'yu Çek
      - name: Checkout Repo
        uses: actions/checkout@v4 # Daha güncel versiyon kullanıldı

      # 2. Functions Bağımlılıklarını Kur
      # Bu adımı koruyoruz çünkü 'bad-words' gibi özel bağımlılıklar var.
      - name: Install Functions Dependencies (Node 18)
        run: cd functions && npm install
        
      # 3. Firebase Action ile Dağıtım (Tüm CLI adımlarının yerini alır)
      - name: Deploy to Firebase
        uses: w9jds/firebase-action@v2 # Hazır Action kullanıldı
        with:
          # Dağıtım argümanları: sadece functions dağıt
          args: deploy --only functions
          
        env:
          # Projenin ID'sini ve Token'ı environment değişkenleri olarak geçiriyoruz
          FIREBASE_TOKEN: ${{ secrets.FIREBASE_TOKEN }}
          # Buraya Firebase Proje ID'nizi EKLEMEYİ unutmayın! (Örneğin: topreqclans-63d88)
          PROJECT_ID: top-req-clans-63d88 # Lütfen bu değeri kontrol edin!
